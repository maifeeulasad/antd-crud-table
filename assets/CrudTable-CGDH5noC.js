import{r as y,j as a,B as p}from"./index-ZoKaomao.js";import{F as i,T as F,f as M,p as P,g as D,P as N,a as _,R as $,D as B,b as V,M as H,S as z,c as A,d as K,e as L,I as U,s as h,h as W}from"./CrudTable-F3ZKUo9P.js";const J=C=>{const l=y.useRef(null),{columns:u,service:o,rowKey:c,title:w,defaultPageSize:T=5}=C,[q,x]=y.useState(!1),[m,v]=y.useState(null),[f]=i.useForm();let j=(u||[]).map(e=>{const t={...e,dataIndex:e.dataIndex,title:e.title};switch(e.fieldType){case"date":return{...t,valueType:"dateTime",render:(r,s)=>a.jsx("span",{children:M(P(s[e.dataIndex]),"yyyy-MM-dd HH:mm")})};case"enum":return{...t,valueType:"select",valueEnum:e.enumOptions};case"number":return{...t,valueType:"digit"};case"boolean":return{...t,valueType:"switch",render:(r,s)=>a.jsx(F,{color:s[e.dataIndex]?"green":"red",children:s[e.dataIndex]?"Yes":"No"})};case"custom":return{...t,render:(r,s)=>{var n;return(n=e.customRender)==null?void 0:n.call(e,s[e.dataIndex],s)}};default:return t}});j.push({title:"Actions",valueType:"option",render:(e,t)=>[a.jsx(p,{type:"primary",onClick:()=>b(t),children:"Edit"},"edit"),a.jsx(p,{type:"primary",danger:!0,onClick:async()=>{var r;await o.delete(t[c]),(r=l.current)==null||r.reload()},children:"Delete"},"delete")]});const R=async(e,t,r)=>{try{const s={...e,sortBy:Object.keys(t)[0],sortOrder:Object.values(t)[0],...r},{data:n,total:d}=await o.getList(s);return{data:n,success:!0,total:d}}catch{return h.error("Failed to fetch data"),{data:[],success:!1,total:0}}},b=e=>{if(v(e||null),e){const t={...e};u.forEach(r=>{const s=r.dataIndex;r.fieldType==="date"&&t[s]&&(t[s]=D(t[s]))}),f.setFieldsValue(t)}else f.resetFields();x(!0)},k=async()=>{var e;try{const t=await f.validateFields(),r={...t};u.forEach(s=>{var d;const n=s.dataIndex;s.fieldType==="date"&&t[n]&&(r[n]=W(t[n])),(d=s.formConfig)!=null&&d.transform&&(r[n]=s.formConfig.transform(t[n]))}),m&&m[c]?(await o.update(m[c],r),h.success("Updated successfully")):(await o.create(r),h.success("Created successfully")),x(!1),(e=l.current)==null||e.reload()}catch(t){console.error(t),h.error("Submit failed")}},O=()=>{x(!1)};return a.jsxs(N,{needDeps:!0,children:[a.jsx(_,{headerTitle:w,rowKey:c,rowClassName:(e,t)=>t%2===0&&"row-differentiator"||"",actionRef:l,columns:j,request:R,search:{labelWidth:"auto"},pagination:{pageSize:T},toolBarRender:()=>[a.jsx(p,{type:"primary",icon:a.jsx($,{}),onClick:()=>b(),children:"New"},"add"),a.jsx(B,{menu:{items:[{key:"export",label:"Export"},{key:"refresh",label:"Refresh",onClick:()=>{var e;return(e=l.current)==null?void 0:e.reload()}}]},children:a.jsx(p,{children:a.jsx(V,{})})},"menu")],options:{setting:{listsHeight:400},reload:()=>{var e;return(e=l.current)==null?void 0:e.reload()}},dateFormatter:"string"}),a.jsx(H,{forceRender:!0,title:m?"Edit Item":"Create Item",open:q,onOk:k,onCancel:O,destroyOnClose:!0,children:a.jsx(i,{form:f,layout:"vertical",children:u.map(e=>{var n,d,g,I;if(!e.dataIndex)return null;const t=e.dataIndex,r=e.title,s=!(e.fieldEditable??!0);switch(e.fieldType){case"string":return a.jsx(i.Item,{name:t,label:r,rules:[{required:(n=e.formConfig)==null?void 0:n.required,message:`${r} is required`}],children:a.jsx(U,{disabled:s})},t);case"number":return a.jsx(i.Item,{name:t,label:r,rules:[{required:(d=e.formConfig)==null?void 0:d.required,message:`${r} is required`}],children:a.jsx(L,{style:{width:"100%"},disabled:s})},t);case"date":return a.jsx(i.Item,{name:t,label:r,rules:[{required:(g=e.formConfig)==null?void 0:g.required,message:`${r} is required`}],children:a.jsx(K,{style:{width:"100%"},showTime:!0,disabled:s})},t);case"boolean":return a.jsx(i.Item,{name:t,label:r,valuePropName:"checked",children:a.jsx(A,{disabled:s})},t);case"enum":return a.jsx(i.Item,{name:t,label:r,rules:[{required:(I=e.formConfig)==null?void 0:I.required,message:`${r} is required`}],children:a.jsx(z,{disabled:s,options:Object.entries(e.enumOptions||{}).map(([S,E])=>({label:E.text,value:S}))})},t);default:return null}})})})]})};export{J as default};
